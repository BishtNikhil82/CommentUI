(()=>{var e={};e.id=567,e.ids=[567],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},7163:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var o={};s.r(o),s.d(o,{POST:()=>u});var r=s(9303),n=s(8716),i=s(670),a=s(7070),c=s(1165),l=s(7030);async function u(e){try{let t=await (0,c.Gg)(e);if(!t||!t.access_token||!t.user?.id)return console.warn("[AUTH] Unauthorized access attempt"),a.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.access_token;if(!s.startsWith("ya29"))return console.warn("[AUTH] Invalid YouTube token:",s.slice(0,6)),a.NextResponse.json({error:"YouTube token not found. Please re-authenticate."},{status:401});let{query:o}=await e.json();if(!o||"string"!=typeof o)return a.NextResponse.json({error:"Query must be a non-empty string."},{status:400});let r=t.user_profile_id;if(!r)return console.warn("[AUTH] No user profile ID in session for user:",t.user.id),a.NextResponse.json({error:"User profile not found. Please re-authenticate."},{status:401});console.log("[AUTH] Using user profile ID from session:",r),console.log(`[JOB] Creating job for topic: ${o}`);let{data:n,error:i}=await l.Z.from("jobs").insert({user_id:r,topic:o,status:"processing"}).select("id").single();if(i)return console.error("[DB] Failed to insert job:",i.message),a.NextResponse.json({error:"Failed to create job entry."},{status:500});let u=n.id;console.log("[DB] Job inserted successfully:",u);let p=process.env.PYTHON_BACKEND_URL||"http://localhost:8000",h=new URL(`${p}/analyze-youtube`);return h.searchParams.set("query",o),h.searchParams.set("maxResults","5"),h.searchParams.set("order","relevance"),h.searchParams.set("regionCode","IN"),h.searchParams.set("job_id",u),fetch(h.toString(),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}).then(()=>{console.log("[PYTHON] Analysis triggered for job:",u)}).catch(e=>{console.error("[PYTHON] Failed to trigger analysis:",e.message)}),a.NextResponse.json({job_id:u},{status:202})}catch(e){return console.error("[API] /analytics error:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Unexpected server error"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"D:\\2025\\Git\\CommentUI\\src\\app\\api\\analytics\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:g}=p,f="/api/analytics/route";function m(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},4183:(e,t,s)=>{"use strict";s.d(t,{T8:()=>r,bG:()=>c,jb:()=>a,pw:()=>l,rz:()=>i,th:()=>n,yS:()=>u});let o={authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,redirectUri:(()=>{let e="http://localhost:3000",t=`${e}/auth/callback`;return console.log("\uD83D\uDD27 Environment check:",{NEXT_PUBLIC_APP_URL:"http://localhost:3000",appUrl:e,redirectUri:t}),t})(),scopes:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/youtube.force-ssl"};console.log("\uD83D\uDD27 GOOGLE_OAUTH_CONFIG:",{clientId:o.clientId?"SET":"MISSING",clientSecret:o.clientSecret?"SET":"MISSING",redirectUri:o.redirectUri,scopes:o.scopes});let r={name:"auth_session",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"};function n(e){console.log("\uD83D\uDD17 Generating Google OAuth URL with state:",e);let t=o.authUrl,s=new URLSearchParams;s.append("client_id",o.clientId),s.append("redirect_uri",o.redirectUri),s.append("response_type","code"),s.append("scope",o.scopes),s.append("access_type","offline"),s.append("prompt","consent"),e&&s.append("state",e);let r=`${t}?${s.toString()}`;return console.log("\uD83D\uDD17 Generated OAuth URL:",r),console.log("\uD83D\uDD17 Redirect URI being sent:",o.redirectUri),r}async function i(e){console.log("\uD83D\uDD04 Exchanging authorization code for tokens..."),console.log("\uD83D\uDD04 Code length:",e.length);let t=await fetch(o.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:o.clientId,client_secret:o.clientSecret,code:e,grant_type:"authorization_code",redirect_uri:o.redirectUri})});if(console.log("\uD83D\uDD04 Token exchange response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token exchange failed:",e),Error(`Token exchange failed: ${e}`)}let s=await t.json();return console.log("✅ Token exchange successful:",{hasAccessToken:!!s.access_token,hasRefreshToken:!!s.refresh_token,expiresIn:s.expires_in,scope:s.scope}),s}async function a(e){console.log("\uD83D\uDD04 Refreshing access token...");let t=await fetch(o.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:o.clientId,client_secret:o.clientSecret,refresh_token:e,grant_type:"refresh_token"})});if(console.log("\uD83D\uDD04 Token refresh response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token refresh failed:",e),Error(`Token refresh failed: ${e}`)}let s=await t.json();return console.log("✅ Token refresh successful:",{hasAccessToken:!!s.access_token,expiresIn:s.expires_in}),s}async function c(e){console.log("\uD83D\uDC64 Fetching user info from Google...");let t=await fetch(o.userInfoUrl,{headers:{Authorization:`Bearer ${e}`}});if(console.log("\uD83D\uDC64 User info response status:",t.status),!t.ok)throw console.error("❌ Failed to fetch user info:",await t.text()),Error("Failed to fetch user info");let s=await t.json();return console.log("✅ User info fetched successfully:",{id:s.id,email:s.email,name:s.name,verified:s.verified_email}),s}function l(e){let t=Date.now()>=e;return console.log("⏰ Token expiration check:",{expiresAt:new Date(e).toISOString(),now:new Date().toISOString(),expired:t}),t}function u(e,t,s,o=t.expires_in){let r={user:e,access_token:t.access_token,refresh_token:t.refresh_token,expires_at:Date.now()+1e3*o,user_profile_id:s};return console.log("\uD83D\uDCE6 Created session data:",{userId:e.id,userEmail:e.email,userProfileId:s,hasAccessToken:!!r.access_token,hasRefreshToken:!!r.refresh_token,expiresAt:new Date(r.expires_at).toISOString()}),r}},1165:(e,t,s)=>{"use strict";s.d(t,{Gg:()=>n,KY:()=>i,Ov:()=>a});var o=s(1615);s(7070);var r=s(4183);async function n(e){console.log("\uD83C\uDF6A Getting session from cookies...");try{let t=(e?e.cookies:(0,o.cookies)()).get(r.T8.name);if(console.log("\uD83C\uDF6A Session cookie found:",!!t?.value),!t?.value)return console.log("❌ No session cookie found"),null;let s=JSON.parse(t.value);if(console.log("\uD83C\uDF6A Parsed session data:",{userId:s.user?.id,userEmail:s.user?.email,hasAccessToken:!!s.access_token,hasRefreshToken:!!s.refresh_token,expiresAt:new Date(s.expires_at).toISOString()}),(0,r.pw)(s.expires_at)){if(console.log("⏰ Token is expired, attempting refresh..."),!s.refresh_token)return console.log("❌ No refresh token available"),null;try{let e=await (0,r.jb)(s.refresh_token),t={...s,access_token:e.access_token,expires_at:Date.now()+1e3*e.expires_in};return console.log("✅ Token refreshed successfully"),t}catch(e){return console.error("❌ Failed to refresh token:",e),null}}return console.log("✅ Session is valid"),s}catch(e){return console.error("❌ Error parsing session:",e),null}}function i(e,t){console.log("\uD83C\uDF6A Setting session cookie...");let s=JSON.stringify(e);return t.cookies.set(r.T8.name,s,{httpOnly:r.T8.httpOnly,secure:r.T8.secure,sameSite:r.T8.sameSite,maxAge:r.T8.maxAge,path:r.T8.path}),console.log("✅ Session cookie set successfully"),t}function a(e){return console.log("\uD83C\uDF6A Clearing session cookie..."),e.cookies.delete(r.T8.name),console.log("✅ Session cookie cleared"),e}},7030:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});let o=(0,s(8005).createBrowserClient)("https://qopbjuixcnrjyibiotko.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvcGJqdWl4Y25yanlpYmlvdGtvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNzk2NzEsImV4cCI6MjA2ODc1NTY3MX0.riXsWN0WueR4Dcelss00dHR75KIVHXblkIzmvbnhtuE")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[948,972,212],()=>s(7163));module.exports=o})();