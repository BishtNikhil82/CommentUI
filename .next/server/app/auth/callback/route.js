(()=>{var e={};e.id=936,e.ids=[936],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},5276:(e,t,o)=>{"use strict";o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>k,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>D,staticGenerationAsyncStorage:()=>g});var r={};o.r(r),o.d(r,{GET:()=>p});var s=o(9303),n=o(8716),i=o(670),a=o(7070),c=o(4183),l=o(1165),u=o(7030);async function p(e){console.log("\uD83D\uDD04 OAuth callback route called"),console.log("\uD83D\uDD04 Full request URL:",e.url);let{searchParams:t}=new URL(e.url),o=t.get("code"),r=t.get("state"),s=t.get("error");if(console.log("\uD83D\uDD04 Callback parameters:",{hasCode:!!o,hasState:!!r,hasError:!!s,error:s,codeLength:o?.length,stateLength:r?.length}),s)return console.error("❌ OAuth error:",s),a.NextResponse.redirect(new URL("/auth/login?error=oauth_error",e.url));if(!o)return console.error("❌ No authorization code received"),a.NextResponse.redirect(new URL("/auth/login?error=no_code",e.url));try{let t;console.log("\uD83D\uDD04 Starting token exchange...");let s=await (0,c.rz)(o);if(console.log("\uD83D\uDD04 Token exchange result:",{hasAccessToken:!!s.access_token,hasRefreshToken:!!s.refresh_token,expiresIn:s.expires_in,tokenType:s.token_type}),!s.access_token)throw Error("No access token received");console.log("\uD83D\uDD04 Getting user info...");let n=await (0,c.bG)(s.access_token);console.log("\uD83D\uDD04 User info received:",{userId:n.id,userEmail:n.email,userName:n.name,userPicture:!!n.picture}),console.log("\uD83D\uDD04 Checking user profile in database...");try{let{data:e,error:o}=await u.Z.from("users").select("id").eq("id",n.id).single();if(o&&"PGRST116"!==o.code&&console.error("❌ Error checking user profile:",o),e)console.log("✅ User profile already exists"),t=e.id;else{console.log("\uD83D\uDD04 User not found in users table, creating new profile...");let{error:e}=await u.Z.from("users").insert({id:n.id,email:n.email,display_name:n.name,avatar_url:n.picture,created_at:new Date().toISOString()});e?console.error("❌ Failed to create user profile:",e):console.log("✅ User profile created successfully"),t=n.id}}catch(e){console.error("❌ Error in user profile management:",e),t=n.id}console.log("\uD83D\uDD04 Creating session data...");let i=(0,c.yS)(n,s,t);console.log("\uD83D\uDD04 Session data created:",{userId:i.user?.id,userEmail:i.user?.email,hasAccessToken:!!i.access_token,hasRefreshToken:!!i.refresh_token,expiresAt:new Date(i.expires_at).toISOString()});let p="/dashboard";if(r)try{let e=JSON.parse(Buffer.from(r,"base64").toString());p=e.next||"/dashboard",console.log("\uD83D\uDD04 Parsed state data:",e)}catch(e){console.error("❌ Error parsing state:",e)}console.log("\uD83D\uDD04 Final redirect URL:",p);let d=a.NextResponse.redirect(new URL(p,e.url));return console.log("\uD83D\uDD04 Setting session cookie..."),(0,l.KY)(i,d),console.log("✅ Authentication successful, redirecting to:",p),console.log("✅ Response headers:",Object.fromEntries(d.headers.entries())),d}catch(t){return console.error("❌ Authentication error:",t),console.error("❌ Error details:",{message:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:void 0}),a.NextResponse.redirect(new URL("/auth/login?error=auth_failed",e.url))}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/auth/callback/route",pathname:"/auth/callback",filename:"route",bundlePath:"app/auth/callback/route"},resolvedPagePath:"D:\\2025\\Git\\CommentUI\\src\\app\\auth\\callback\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:D}=d,f="/auth/callback/route";function k(){return(0,i.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:g})}},4183:(e,t,o)=>{"use strict";o.d(t,{T8:()=>s,bG:()=>c,jb:()=>a,pw:()=>l,rz:()=>i,th:()=>n,yS:()=>u});let r={authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,redirectUri:(()=>{let e="http://localhost:3000",t=`${e}/auth/callback`;return console.log("\uD83D\uDD27 Environment check:",{NEXT_PUBLIC_APP_URL:"http://localhost:3000",appUrl:e,redirectUri:t}),t})(),scopes:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/youtube.force-ssl"};console.log("\uD83D\uDD27 GOOGLE_OAUTH_CONFIG:",{clientId:r.clientId?"SET":"MISSING",clientSecret:r.clientSecret?"SET":"MISSING",redirectUri:r.redirectUri,scopes:r.scopes});let s={name:"auth_session",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"};function n(e){console.log("\uD83D\uDD17 Generating Google OAuth URL with state:",e);let t=r.authUrl,o=new URLSearchParams;o.append("client_id",r.clientId),o.append("redirect_uri",r.redirectUri),o.append("response_type","code"),o.append("scope",r.scopes),o.append("access_type","offline"),o.append("prompt","consent"),e&&o.append("state",e);let s=`${t}?${o.toString()}`;return console.log("\uD83D\uDD17 Generated OAuth URL:",s),console.log("\uD83D\uDD17 Redirect URI being sent:",r.redirectUri),s}async function i(e){console.log("\uD83D\uDD04 Exchanging authorization code for tokens..."),console.log("\uD83D\uDD04 Code length:",e.length);let t=await fetch(r.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:r.clientId,client_secret:r.clientSecret,code:e,grant_type:"authorization_code",redirect_uri:r.redirectUri})});if(console.log("\uD83D\uDD04 Token exchange response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token exchange failed:",e),Error(`Token exchange failed: ${e}`)}let o=await t.json();return console.log("✅ Token exchange successful:",{hasAccessToken:!!o.access_token,hasRefreshToken:!!o.refresh_token,expiresIn:o.expires_in,scope:o.scope}),o}async function a(e){console.log("\uD83D\uDD04 Refreshing access token...");let t=await fetch(r.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:r.clientId,client_secret:r.clientSecret,refresh_token:e,grant_type:"refresh_token"})});if(console.log("\uD83D\uDD04 Token refresh response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token refresh failed:",e),Error(`Token refresh failed: ${e}`)}let o=await t.json();return console.log("✅ Token refresh successful:",{hasAccessToken:!!o.access_token,expiresIn:o.expires_in}),o}async function c(e){console.log("\uD83D\uDC64 Fetching user info from Google...");let t=await fetch(r.userInfoUrl,{headers:{Authorization:`Bearer ${e}`}});if(console.log("\uD83D\uDC64 User info response status:",t.status),!t.ok)throw console.error("❌ Failed to fetch user info:",await t.text()),Error("Failed to fetch user info");let o=await t.json();return console.log("✅ User info fetched successfully:",{id:o.id,email:o.email,name:o.name,verified:o.verified_email}),o}function l(e){let t=Date.now()>=e;return console.log("⏰ Token expiration check:",{expiresAt:new Date(e).toISOString(),now:new Date().toISOString(),expired:t}),t}function u(e,t,o,r=t.expires_in){let s={user:e,access_token:t.access_token,refresh_token:t.refresh_token,expires_at:Date.now()+1e3*r,user_profile_id:o};return console.log("\uD83D\uDCE6 Created session data:",{userId:e.id,userEmail:e.email,userProfileId:o,hasAccessToken:!!s.access_token,hasRefreshToken:!!s.refresh_token,expiresAt:new Date(s.expires_at).toISOString()}),s}},1165:(e,t,o)=>{"use strict";o.d(t,{Gg:()=>n,KY:()=>i,Ov:()=>a});var r=o(1615);o(7070);var s=o(4183);async function n(e){console.log("\uD83C\uDF6A Getting session from cookies...");try{let t=(e?e.cookies:(0,r.cookies)()).get(s.T8.name);if(console.log("\uD83C\uDF6A Session cookie found:",!!t?.value),!t?.value)return console.log("❌ No session cookie found"),null;let o=JSON.parse(t.value);if(console.log("\uD83C\uDF6A Parsed session data:",{userId:o.user?.id,userEmail:o.user?.email,hasAccessToken:!!o.access_token,hasRefreshToken:!!o.refresh_token,expiresAt:new Date(o.expires_at).toISOString()}),(0,s.pw)(o.expires_at)){if(console.log("⏰ Token is expired, attempting refresh..."),!o.refresh_token)return console.log("❌ No refresh token available"),null;try{let e=await (0,s.jb)(o.refresh_token),t={...o,access_token:e.access_token,expires_at:Date.now()+1e3*e.expires_in};return console.log("✅ Token refreshed successfully"),t}catch(e){return console.error("❌ Failed to refresh token:",e),null}}return console.log("✅ Session is valid"),o}catch(e){return console.error("❌ Error parsing session:",e),null}}function i(e,t){console.log("\uD83C\uDF6A Setting session cookie...");let o=JSON.stringify(e);return t.cookies.set(s.T8.name,o,{httpOnly:s.T8.httpOnly,secure:s.T8.secure,sameSite:s.T8.sameSite,maxAge:s.T8.maxAge,path:s.T8.path}),console.log("✅ Session cookie set successfully"),t}function a(e){return console.log("\uD83C\uDF6A Clearing session cookie..."),e.cookies.delete(s.T8.name),console.log("✅ Session cookie cleared"),e}},7030:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});let r=(0,o(8005).createBrowserClient)("https://qopbjuixcnrjyibiotko.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvcGJqdWl4Y25yanlpYmlvdGtvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNzk2NzEsImV4cCI6MjA2ODc1NTY3MX0.riXsWN0WueR4Dcelss00dHR75KIVHXblkIzmvbnhtuE")}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,972,212],()=>o(5276));module.exports=r})();