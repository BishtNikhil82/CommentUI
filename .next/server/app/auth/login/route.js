"use strict";(()=>{var e={};e.id=302,e.ids=[302],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7717:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>g,patchFetch:()=>D,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h});var r={};o.r(r),o.d(r,{GET:()=>l});var n=o(9303),s=o(8716),a=o(670),i=o(7070),c=o(4183);async function l(e){console.log("\uD83D\uDE80 Login route called");let{searchParams:t}=new URL(e.url),o=t.get("next")||"/dashboard";console.log("\uD83D\uDE80 Next redirect URL:",o);let r=Buffer.from(JSON.stringify({next:o})).toString("base64");console.log("\uD83D\uDE80 Generated state:",r);let n=(0,c.th)(r);return console.log("\uD83D\uDE80 Redirecting to Google OAuth:",n),i.NextResponse.redirect(n)}let u=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/auth/login/route",pathname:"/auth/login",filename:"route",bundlePath:"app/auth/login/route"},resolvedPagePath:"D:\\2025\\Git\\CommentUI\\src\\app\\auth\\login\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:d}=u,g="/auth/login/route";function D(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},4183:(e,t,o)=>{o.d(t,{T8:()=>n,bG:()=>c,jb:()=>i,pw:()=>l,rz:()=>a,th:()=>s,yS:()=>u});let r={authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,redirectUri:(()=>{let e="http://localhost:3000",t=`${e}/auth/callback`;return console.log("\uD83D\uDD27 Environment check:",{NEXT_PUBLIC_APP_URL:"http://localhost:3000",appUrl:e,redirectUri:t}),t})(),scopes:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/youtube.force-ssl"};console.log("\uD83D\uDD27 GOOGLE_OAUTH_CONFIG:",{clientId:r.clientId?"SET":"MISSING",clientSecret:r.clientSecret?"SET":"MISSING",redirectUri:r.redirectUri,scopes:r.scopes});let n={name:"auth_session",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"};function s(e){console.log("\uD83D\uDD17 Generating Google OAuth URL with state:",e);let t=r.authUrl,o=new URLSearchParams;o.append("client_id",r.clientId),o.append("redirect_uri",r.redirectUri),o.append("response_type","code"),o.append("scope",r.scopes),o.append("access_type","offline"),o.append("prompt","consent"),e&&o.append("state",e);let n=`${t}?${o.toString()}`;return console.log("\uD83D\uDD17 Generated OAuth URL:",n),console.log("\uD83D\uDD17 Redirect URI being sent:",r.redirectUri),n}async function a(e){console.log("\uD83D\uDD04 Exchanging authorization code for tokens..."),console.log("\uD83D\uDD04 Code length:",e.length);let t=await fetch(r.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:r.clientId,client_secret:r.clientSecret,code:e,grant_type:"authorization_code",redirect_uri:r.redirectUri})});if(console.log("\uD83D\uDD04 Token exchange response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token exchange failed:",e),Error(`Token exchange failed: ${e}`)}let o=await t.json();return console.log("✅ Token exchange successful:",{hasAccessToken:!!o.access_token,hasRefreshToken:!!o.refresh_token,expiresIn:o.expires_in,scope:o.scope}),o}async function i(e){console.log("\uD83D\uDD04 Refreshing access token...");let t=await fetch(r.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:r.clientId,client_secret:r.clientSecret,refresh_token:e,grant_type:"refresh_token"})});if(console.log("\uD83D\uDD04 Token refresh response status:",t.status),!t.ok){let e=await t.text();throw console.error("❌ Token refresh failed:",e),Error(`Token refresh failed: ${e}`)}let o=await t.json();return console.log("✅ Token refresh successful:",{hasAccessToken:!!o.access_token,expiresIn:o.expires_in}),o}async function c(e){console.log("\uD83D\uDC64 Fetching user info from Google...");let t=await fetch(r.userInfoUrl,{headers:{Authorization:`Bearer ${e}`}});if(console.log("\uD83D\uDC64 User info response status:",t.status),!t.ok)throw console.error("❌ Failed to fetch user info:",await t.text()),Error("Failed to fetch user info");let o=await t.json();return console.log("✅ User info fetched successfully:",{id:o.id,email:o.email,name:o.name,verified:o.verified_email}),o}function l(e){let t=Date.now()>=e;return console.log("⏰ Token expiration check:",{expiresAt:new Date(e).toISOString(),now:new Date().toISOString(),expired:t}),t}function u(e,t,o,r=t.expires_in){let n={user:e,access_token:t.access_token,refresh_token:t.refresh_token,expires_at:Date.now()+1e3*r,user_profile_id:o};return console.log("\uD83D\uDCE6 Created session data:",{userId:e.id,userEmail:e.email,userProfileId:o,hasAccessToken:!!n.access_token,hasRefreshToken:!!n.refresh_token,expiresAt:new Date(n.expires_at).toISOString()}),n}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,972],()=>o(7717));module.exports=r})();